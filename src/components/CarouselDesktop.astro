---
import { Image } from "astro:assets";
import CafeAromaImg from "../assets/CafeAromaProject.jpg";
import nextImg from "../assets/technologies/next.png";
import typescriptImg from "../assets/technologies/typescript.png";
import nodejsImg from "../assets/technologies/nodeJs.png";
import expressImg from "../assets/technologies/expressJs.webp";
import mongodbImg from "../assets/technologies/mongodb.png";
import GithubIcon from "../icons/GithubIcon.astro";
import { getLangFromUrl, useTranslations } from "../i18n/utils"

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const projects = [
  {
    title: "Cafe Aroma",
    description: t("portfolio.project1.description"),
    imageUrl: CafeAromaImg,
    githubLink: "https://github.com/Dabs127/cafearoma-frontend",
    technologies: [
      { name: "Next", image: nextImg.src },
      { name: "Typescript", image: typescriptImg.src },
      { name: "Node.js", image: nodejsImg.src },
      { name: "Express", image: expressImg.src },
      { name: "MongoDB", image: mongodbImg.src },
    ],
  },
];
---

<div class="w-full relative space-y-8 hidden lg:block">
  <!-- Grid de 3 proyectos -->
  <div class="grid grid-cols-3 gap-8">
    {
      projects.map((p, idx) => (
        <div
          class="project-card cursor-pointer transition-all duration-300 hover:scale-105"
          data-index={idx}
        >
          <div
            class={`relative h-90 rounded-3xl overflow-hidden ${idx === 0 ? "ring-8 ring-primary" : "opacity-60"}`}
          >
            <Image
              src={p.imageUrl}
              alt={`Image about project ${p.title}`}
              class="w-full h-full object-cover"
            />
            <a
              href={p.githubLink}
              target="_blank"
              rel="noopener noreferrer"
              onclick="(e) => e.stopPropagation()"
            >
              <GithubIcon
                size="40"
                class="absolute top-4 right-4 cursor-pointer hover:scale-110 transition-transform z-10"
                fill="#ffffff"
              />
            </a>
          </div>
        </div>
      ))
    }
  </div>

  <!-- Info del proyecto seleccionado -->
  <div class="w-full flex flex-col items-center text-center px-5">
    <h4
      id="project-title-desktop"
      class="text-3xl text-secondary font-extrabold dark:text-text-dark-primary"
    >
      {projects[0]?.title}
    </h4>
    <p id="project-description-desktop" class="max-w-3xl mt-3 text-lg dark:text-text-dark-primary">
      {projects[0]?.description}
    </p>
    <div
      id="tech-stack-container-desktop"
      class="mt-6 flex justify-center gap-6 flex-wrap max-w-2xl"
    >
      {
        projects[0]?.technologies.map((tech) => (
          <img
            src={tech.image}
            alt={tech.name}
            title={tech.name}
            class="w-14 h-14 object-contain hover:scale-110 transition-transform"
          />
        ))
      }
    </div>
  </div>
</div>

<script define:vars={{ projects }}>
  const projectCards = document.querySelectorAll(".project-card");
  const projectTitle = document.querySelector("#project-title-desktop");
  const projectDescription = document.querySelector(
    "#project-description-desktop",
  );
  const techContainer = document.getElementById("tech-stack-container-desktop");

  let selectedIndex = 0;

  const updateSelection = (newIndex) => {
    selectedIndex = newIndex;

    // Actualizar estilos de las tarjetas
    projectCards.forEach((card, i) => {
      const cardElement = card.querySelector("div");
      if (i === selectedIndex) {
        cardElement.classList.add("ring-8", "ring-primary");
        cardElement.classList.remove("opacity-60");
      } else {
        cardElement.classList.remove("ring-8", "ring-primary");
        cardElement.classList.add("opacity-60");
      }
    });

    // Actualizar informaciÃ³n del proyecto
    if (projectTitle)
      projectTitle.textContent = projects[selectedIndex]?.title || "";
    if (projectDescription)
      projectDescription.textContent =
        projects[selectedIndex]?.description || "";

    const techStack = projects[selectedIndex]?.technologies || [];
    if (techContainer) {
      techContainer.innerHTML = techStack
        .map(
          (tech) =>
            `<img src="${tech.image}" alt="${tech.name}" title="${tech.name}" class="w-14 h-14 object-contain hover:scale-110 transition-transform" />`,
        )
        .join("");
    }
  };

  // Event listeners para cada tarjeta
  projectCards.forEach((card, index) => {
    card.addEventListener("click", () => {
      updateSelection(index);
    });
  });
</script>
