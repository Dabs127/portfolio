---
import { Image } from "astro:assets";
import { Menu, X } from "@lucide/astro";
import { getLangFromUrl, useTranslations } from "../i18n/utils"

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<header class="w-full h-auto max-h-min mb-5 sm:py-3 md:mx-auto lg:max-w-4/5">
  <nav
    class="flex justify-between items-center min-h-20 text-white bg-[#3A3335] sm:p-5 sm:rounded-full"
  >
    <ul
      class="hidden sm:flex sm:basis-2/5 sm:items-center justify-center sm:text-center sm:space-x-8
    [&>a]:rounded-full
    [&>a]:text-lg
    [&>a]:hidden
    [&>a]:sm:flex
    "
    >
      <a href="#home">{t("nav.home")}</a>
      <a href="#work-experience">{t("nav.workexperience")}</a>
      <a href="#why-hire-me">{t("nav.whyhireme")}</a>
    </ul>

    <div
      class="group flex items-center gap-x-3 text-white sm:basis-1/5 sm:justify-center"
    >
      <span
        class="bg-primary py-3 px-5 rounded-full text-2xl font-bold
           opacity-100 translate-y-0
           group-hover:opacity-0 group-hover:-translate-y-2
           transition-all duration-300"
      >
        DABS
      </span>

      <div
        class="text-xl absolute
           opacity-0 translate-y-2 pointer-events-none
           group-hover:opacity-100 group-hover:translate-y-0
           transition-all duration-300"
      >
        <span>{t("nav.madeby")}</span>
        <span>Daniel Serna</span>
      </div>
    </div>

    <ul
      class="hidden sm:flex sm:basis-2/5 sm:justify-start sm:items-center sm:space-x-6 [&>a]:py-4
    [&>a]:rounded-full
    [&>a]:text-lg
    [&>a]:hidden
    [&>a]:sm:flex
    "
    >
      <a href="#projects">{t("nav.projects")}</a>
      <a href="#tech-stack">Tech Stack</a>
    </ul>
    <button id="menu-btn" class="z-40 mr-4 text-white md:hidden">
      <span id="menu-burguer-span" class="icon-open"
        ><Menu class="w-10 h-10" /></span
      >
    </button>
  </nav>
  <button id="menu-btn-x" class="fixed top-4 right-4 text-white z-40">
    <span id="menu-x-span" class="icon-close hidden"
      ><X class="w-10 h-10" /></span
    >
  </button>
  <div
    id="mobile-menu"
    class="fixed top-0 right-0 w-20 h-20 bg-primary rounded-full menu-closed transform transition-transform duration-500 ease-in-out z-20 sm:hidden"
  >
  </div>
  <div
    id="mobile-menu-list"
    class="menu-list-closed -translate-y-20 transition-opacity duration-500 z-30 sm:hidden sm:pointer-events-none"
  >
    <a
      href="#home"
      class="absolute opacity-0 transition-all duration-400 ease-in-out">HOME</a
    >
    <a
      href="#work-experience"
      class="absolute opacity-0 transition-all duration-400 ease-in-out"
      >WORK EXPERIENCE</a
    >
    <a
      href="#why-hire-me"
      class="absolute opacity-0 transition-all duration-400 ease-in-out"
      >WHY HIRE ME</a
    >
    <a
      href="#projects"
      class="absolute opacity-0 transition-all duration-400 ease-in-out"
      >PROJECTS</a
    >
    <a
      href="#tech-stack"
      class="absolute opacity-0 transition-all duration-400 ease-in-out"
      >TECH STACK</a
    >
  </div>
</header>

<style>
  @reference "../styles/global.css"

  span {
    font-family: "Nunito", sans-serif;
  }

  #mobile-menu-list {
    @apply fixed inset-0 w-full text-white flex flex-col items-center justify-start text-4xl font-bold space-y-10;
  }

  .menu-open {
    transform: translate(0, 100%);
    transform: scale(25);
  }

  .menu-closed {
    transform: translate(100%, 0);
  }

  .menu-list-open {
    @apply opacity-100 h-dvh;
  }

  .menu-list-closed {
    @apply opacity-0 h-0;
  }
</style>

<script>
  const menuBtn = document.getElementById("menu-btn");
  const menuBtnX = document.getElementById("menu-btn-x");
  const menu = document.getElementById("mobile-menu");
  const menuList = document.getElementById("mobile-menu-list");
  const spanBurguerMenu = document.getElementById("menu-burguer-span");
  const spanXMenu = document.getElementById("menu-x-span");
  const linksMobileMenu = menuList?.querySelectorAll("a");

  let isOpen = false;

  const toggleMenu = () => {
    isOpen = !isOpen;
    const translateYStart = 100;
    let translateYQuantity = translateYStart;

    spanBurguerMenu?.classList.toggle("hidden", isOpen);
    spanXMenu?.classList.toggle("hidden", !isOpen);
    menu?.classList.toggle("menu-open", isOpen);
    menu?.classList.toggle("menu-closed", !isOpen);
    menuList?.classList.toggle("menu-list-open", isOpen);
    menuList?.classList.toggle("menu-list-closed", !isOpen);

    if (isOpen) {
      menuList?.classList.replace("-translate-y-20", "translate-y-30");

      setTimeout(() => {
        linksMobileMenu?.forEach((link) => {
          link.style.transform = `translateY(${translateYQuantity}px)`;
          link.classList.replace("opacity-0", "opacity-100");
          translateYQuantity += 100;
        });
      }, 100);
    } else {
      setTimeout(() => {
        menuList?.classList.replace("translate-y-30", "-translate-y-20");
      }, 500);
      linksMobileMenu?.forEach((link) => {
        link.style.removeProperty("transform");
        link.classList.replace("opacity-100", "opacity-0");
      });
    }
  };

  menuBtn?.addEventListener("click", toggleMenu);
  menuBtnX?.addEventListener("click", toggleMenu);

  // Opcional: cerrar al hacer clic en un link
  linksMobileMenu?.forEach((link) => {
    link.addEventListener("click", () => {
      if (isOpen) toggleMenu();
    });
  });
</script>
